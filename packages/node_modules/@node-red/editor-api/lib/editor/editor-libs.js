// Dynamic loading support for editor libraries

var apiUtils = require("../util");
var fs = require("fs");
var path = require("path");

var lib2path = {
    "mermaid": "../../../editor-client/public/vendor/mermaid/mermaid.min.js",
};

module.exports = {
    init: function(_settings, _runtimeAPI) {
        settings = _settings;
    },

    get: function(req,res) {
        var name = req.params.name;

        if (name in lib2path) {
            try {
                var lib = path.join(__dirname, lib2path[name]);
                var code = fs.readFileSync(lib);
                res.send(code);
            }
            catch (e) {
                res.status(500).json({code: "runtime_error", message: e.toString()});
            }
        }
        else {
            res.status(400).json({code: "invalid_request", message: `no library: ${name}`});
        }
    },
}
